<!DOCTYPE html>
<html>

<head>
    <title>Video App</title>

    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <!-- <link rel="icon" href="https://picsum.photos/20/20" />  -->
    <!-- jquery link -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous">
    </script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css"
        integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <link rel='stylesheet' href='assets/css/app.css' type="text/css">

    <!-- UIkit CSS -->
    <link rel="stylesheet" href="./assets/css/uikit.css" />

    <!-- UIkit JS -->
    <script src="./assets/js/uikit.js"></script>
    <script src="./assets/js/uikit-icons.js"></script>

    <!-- google font -->
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Peta&family=Noto+Sans&family=Ubuntu:wght@300&display=swap" rel="stylesheet">

    <script src='/socket.io/socket.io.js'></script>
    <script type="module" src='assets/js/rtc.js'></script>
    <script type="module" src='assets/js/events.js'></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/webrtc-adapter/7.3.0/adapter.min.js"
        integrity="sha256-2qQheewaqnZlXJ3RJRghVUwD/3fD9HNqxh4C+zvgmF4=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/1.3.8/FileSaver.min.js'></script>
    <script src='https://cdn.rawgit.com/yahoo/xss-filters/master/dist/xss-filters.js'></script>
    <script src='assets/js/autolink.js'></script>
</head>

<body class="uk-height-viewport">
    <div class="uk-height-viewport">

        <div class="custom-modal" id='recording-options-modal'>
            <div class="custom-modal-content">
                <div class="row text-center">
                    <div class="col-md-6 mb-2">
                        <span class="record-option" id='record-video'>Record video</span>
                    </div>
                    <div class="col-md-6 mb-2">
                        <span class="record-option" id='record-screen'>Record screen</span>
                    </div>
                </div>

                <div class="row mt-3">
                    <div class="col-md-12 text-center">
                        <button class="btn btn-outline-danger" id='closeModal'>Close</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- <nav class="navbar fixed-top rounded-0 d-print-none" id="nav" style="background: transparent;">
            <a href="/" class="text-white font-family uk-box-shadow-hover-xlarge" style="text-decoration: none;">Royex.live</a>

            <div class="pull-right room-comm" hidden>
                <button class="btn btn-sm rounded-0 btn-no-effect" id='toggle-video' title="Hide Video">
                    <i class="fa fa-video text-white"></i>
                </button>

                <button class="btn btn-sm rounded-0 btn-no-effect" id='toggle-mute' title="Mute">
                    <i class="fa fa-microphone-alt text-white"></i>
                </button>

                <button class="btn btn-sm rounded-0 btn-no-effect" id='share-screen' title="Share screen">
                    <i class="fa fa-desktop text-white"></i>
                </button>

                <button class="btn btn-sm rounded-0 btn-no-effect" id='record' title="Record">
                    <i class="fa fa-dot-circle text-white"></i>
                </button>

                <button class="btn btn-sm text-white pull-right btn-no-effect" id='toggle-chat-pane'>
                    <i class="fa fa-comment"></i> <span class="badge badge-danger very-small font-weight-lighter" id='new-chat-notification' hidden>New</span>
                </button>

                <button class="btn btn-sm rounded-0 btn-no-effect text-white">
                    <a href="/" class="text-white text-decoration-none"><i class="fa fa-sign-out-alt text-white" title="Leave"></i></a>
                </button>
            </div>
        </nav> -->


        <nav class="uk-navbar-container uk-position-top room-comm" hidden uk-navbar id="nav"
            style="background: transparent;">
            <div class="uk-navbar-left mt-2">
                <a href="/" class="text-white font-family uk-box-shadow-hover-xlarge ml-5 h3"
                    style="text-decoration: none;">Royex.live</a>
            </div>
            <div class="uk-navbar-right uk-visible@m">
                <ul class="uk-navbar-nav mt-2">
                    <%- include('./navbar')  %>
                </ul>
            </div>
            <div class="uk-navbar-right uk-hidden@m">
                <button class="uk-button uk-button-default uk-margin-small-right uk-border-rounded" style="border: none" type="button"
                    uk-toggle="target: #offcanvas-reveal"><i class="fas fa-bars text-white pt-3" style="font-size: 2rem;"></i></button>
            </div>
        </nav>

        <!-- off-canvas for mobile menu -->
        <div id="offcanvas-reveal" uk-offcanvas="mode: reveal; overlay: true;flip: true">
            <div class="uk-offcanvas-bar">
                <button class="uk-offcanvas-close" type="button" uk-close></button>
                <div class="uk-offcanvas-bar uk-flex uk-flex-column"
                    style="background-image: url('../assets/img/royex_bg.jpg');">
                    <ul class="uk-nav uk-nav-primary uk-nav-center uk-margin-auto-vertical">
                        <%- include('./navbar')  %>
                    </ul>
                </div>
            </div>
        </div>

        <!-- create room -->
        <div class="uk-container uk-container-small">
            <div id="room-create" hidden>
                <div class="uk-container uk-container-small">
                    <div class="uk-margin-large-top">
                        <h1 class="uk-text-center uk-hidden@m" style="color:#fff;font-size: 4rem;">Royex.live</h1>
                        <h1 class="uk-text-center royex-title uk-visible@m">Royex.live</h1>
                    </div>
                    <br><br>
                </div>
                <div class="uk-child-width-1-2@m uk-child-width-1-1@s uk-grid uk-grid-match" uk-grid>
                    <div>
                        <div class="uk-card border uk-padding white-background uk-border-rounded">
                            <h1 class="uk-text-center mb-5">Start New <strong> Meeting </strong></h1>

                            <div class="uk-margin">
                                <div class="uk-inline uk-width-1-1">
                                    <span class="uk-form-icon" uk-icon="icon: commenting"></span>
                                    <input class="uk-input py-4" id='room-name' placeholder="Meeting Name" required
                                        type="text">
                                </div>
                                <div class="uk-alert-danger uk-hidden" id="alert-room-name" uk-alert>

                                    <p class="form-text text-font" id='err-msg-room-name'></p>
                                </div>
                            </div>
                            <div class="uk-margin">
                                <div class="uk-inline uk-width-1-1">
                                    <span class="uk-form-icon" uk-icon="icon: user"></span>
                                    <input class="uk-input py-4" id='your-name' required placeholder="Name" type="text">
                                </div>
                                <div class="uk-alert-danger uk-hidden" id="alert-name" uk-alert>

                                    <p class="form-text text-font" id='err-msg-name'></p>
                                </div>
                            </div>
                            <div class="uk-margin">
                                <div class="uk-inline uk-width-1-1">
                                    <span class="uk-form-icon" uk-icon="icon: mail"></span>
                                    <input class="uk-input py-4" placeholder="Your Email" required id='your-email'
                                        type="email">
                                </div>
                                <div class="uk-alert-danger uk-hidden" id="alert-email" uk-alert>

                                    <p class="form-text text-font" id='err-msg-email'></p>
                                </div>
                            </div>
                            <div class="uk-margin uk-text-center">
                                <div class="uk-child-width-1-2">
                                    <button
                                        class="uk-button font-family uk-text-bold px-5 py-2 uk-text-center uk-border-rounded uk-box-shadow-hover-xlarge"
                                        style="background-color:#622C80;color:#fff" id='create-room'>Start</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Join Meeting Part -->
                    <div>
                        <div class="uk-card border uk-padding white-background uk-border-rounded">
                            <h1 class="uk-text-center mb-5">Join <br><strong> Meeting </strong></h1>
                            <br><br>
                            <div class="uk-margin uk-width-1-1">
                                <div class="uk-form-controls">
                                    <select class="uk-select" id="join-way" onchange="joinWay(this)"
                                        id="form-stacked-select">
                                        <option value="" selected>Join in meeting with</option>
                                        <option value="url">URL</option>
                                        <option value="meeting-ID">Meeting ID</option>
                                    </select>
                                </div>
                                <div class="uk-alert-danger uk-hidden" id="alert-join-way" uk-alert>

                                    <p class="form-text text-font" id='err-msg-join-way'></p>
                                </div>
                            </div>
                            <div class="uk-margin uk-hidden" id="meeting-ID">
                                <div class="uk-inline uk-width-1-1">
                                    <span class="uk-form-icon" uk-icon="icon:  video-camera"></span>
                                    <input class="uk-input py-4" id="room-join-id"
                                        placeholder="Please input the Meeting ID" type="text">
                                </div>
                                <div class="uk-alert-danger uk-hidden" id="alert-room-id" uk-alert>

                                    <p class="form-text text-font" id='err-msg-room-id'></p>
                                </div>
                            </div>
                            <div class="uk-margin uk-hidden" id="url">
                                <div class="uk-inline uk-width-1-1">
                                    <span class="uk-form-icon" uk-icon="icon: link"></span>
                                    <input class="uk-input py-4" id="room-join-url"
                                        placeholder="Please input the Meeting URL" type="text">
                                </div>
                                <div class="uk-alert-danger uk-hidden" id="alert-room-link" uk-alert>

                                    <p class="form-text text-font" id='err-msg-room-link'></p>
                                </div>
                            </div>
                            <div id="button-break"><br><br></div>
                            <div class="uk-margin uk-text-center">
                                <div class="uk-child-width-1-2">
                                    <button id="join-room"
                                        class="uk-button font-family uk-text-bold px-5 py-2 uk-text-center uk-border-rounded uk-box-shadow-hover-xlarge"
                                        style="background-color:#2376BC;color:#fff">Join</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- After room creation -->
            <div id="room-creation" class="uk-hidden">
                <div class="uk-card uk-border-rounded" style="background-color: #9FC6E7;">
                    <div class="uk-padding-small uk-text-center">
                        <h2 class="mb-2 mt-1 text-font uk-text-bolder">Meeting room successfully created</h2>
                        <h4 class="mt-0 mb-1 text-font">Share the room link with your friends/partner</h4>
                    </div>
                </div><br><br><br><br>
                <div class="uk-text-center">
                    <h2 class="uk-text-bold text-font" id="room-id" style="color:#fff"></h2>
                </div>
                <div class="uk-text-center uk-container uk-container-xsmall">
                    <p class="text-font white-background uk-padding-small uk-margin-large-left uk-margin-large-right"><i
                            class="fas fa-video mr-5"></i><span id="room-created"></span></p>
                    <div class="mx-5 uk-margin-large-right uk-margin-large-left">
                        <div class="mx-5 uk-margin-large-right uk-margin-large-left">
                            <div class="uk-child-width-1-2@m uk-child-width-1-1@s uk-grid-match" uk-grid>
                                <div>
                                    <button
                                        class="uk-button uk-button-secondary py-1 uk-border-rounded uk-box-shadow-hover-xlarge"
                                        onclick="UIkit.notification({message: 'Copied !', status: 'success'});copyClipBoard('#room-created')"><i
                                            class="far fa-copy pr-2 uk-text-large"></i>Copy Link</button>
                                </div>
                                <div>
                                    <button class="uk-button uk-border-rounded py-1 border uk-box-shadow-hover-xlarge"
                                        style="background-color: transparent;color:#fff"><i
                                            class="fas fa-envelope-open-text pr-2 uk-text-large"></i>Invite</button>
                                </div>
                            </div>
                        </div>
                        <br>
                        <div class="mx-5 uk-margin-large-right uk-margin-large-left">
                            <div class="uk-child-width-1-1 uk-grid-match" uk-grid>
                                <div>
                                    <a onclick="roomLink()" id="start-meeting"
                                        class="uk-button uk-border-rounded py-1 border uk-box-shadow-hover-xlarge"
                                        style="background-color: #622C80;color:#fff">Start Now</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- save name before joining into room -->
        <div class="uk-container uk-container-large" id='username-set' hidden>
            <div class="uk-container uk-container-small">
                <div class="uk-margin-large-top">
                    <h1 class="uk-text-center uk-hidden@m" style="color:#fff;font-size: 4rem;">Royex.live</h1>
                    <h1 class="uk-text-center royex-title uk-visible@m">Royex.live</h1>
                </div>
                <br><br>
            </div>
            <div class="uk-child-width-1-3@m uk-child-width-1-1@s uk-grid uk-grid-match" uk-grid id="room-create">
                <div class="uk-visible@m"></div>
                <div>
                    <div class="uk-card border uk-padding white-background uk-border-rounded">
                        <h1 class="uk-text-center text-font mb-5">Set your <strong> Name </strong></h1>
                        <div class="uk-margin">
                            <div class="uk-inline uk-width-1-1">
                                <span class="uk-form-icon" uk-icon="icon: user"></span>
                                <input class="uk-input py-4" id='username' placeholder="Your Name" required type="text">
                            </div>
                            <div class="uk-alert-danger uk-hidden" id="alert-username" uk-alert>
                                <p class="form-text text-font" id='err-msg-username'></p>
                            </div>
                        </div>
                        <div class="uk-margin uk-text-center">
                            <div class="uk-child-width-1-1">
                                <button id="enter-room"
                                    class="uk-button font-family uk-text-bold uk-text-center uk-border-rounded uk-box-shadow-hover-xlarge"
                                    style="background-color:#2376BC;color:#fff">Go</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="uk-visible@m"></div>
            </div>
        </div>

        <!-- video window appearing settings -->
        <div class="room-comm" id="main-section" style="margin-top: 10vh;" hidden>
            <div class="uk-child-width-1-4@m uk-child-width-1-2@s uk-grid-collapse" id='videos' uk-grid>
                <div class="border">
                    <video class="mirror-mode" id='local' volume='0' autoplay muted></video>
                </div>
            </div>
        </div>
        
        <!-- chat settings -->
        <div class="row uk-position-bottom">
            <div class="uk-width-1-5 chat-col d-print-none mb-2 mt-3 border white-background p-0" id='chat-pane' hidden>
                <div class="row">
                    <div class="col-12 uk-text-left h2 mb-3 p-2 pl-5 uk-text-large text-font" style="background: #622C80;color: #fff;">CHAT</div>
                </div>

                <div class="row uk-overflow-auto" id='chat-messages'></div>
                <!-- <div class="uk-inline">
                    <i class="fas fa-paper-plane"></i>
                    <textarea id='chat-input' class="uk-textarea rounded-0 chat-box text-font border-info" rows='3'
                        placeholder="Type here"></textarea>
                </div> -->
                <div class="row">

                    <textarea id='chat-input' style="border-left:none;border-right: none;" class="uk-textarea rounded-0 pb-0 chat-box text-font border-info" rows='3'
                        placeholder="Type here & press enter to send"></textarea>
                </div>
            </div>
        </div>
        
        <br>
    </div>


    <!-- footer -->
    <div class="uk-visible@m " style="background-color: #000;">
        <div class="uk-container uk-container-xlarge uk-text-right">
            <div class="uk-inline py-3">
                <h5 class="mb-1 text-font" style="color: #fff;">Developed by Royex Technologies</h5>
            </div>
        </div>
    </div>
    <div class="uk-hidden@m" style="background-color: #000;">
        <div class="uk-container uk-container-xlarge uk-text-center">
            <div class="uk-inline py-3">
                <h5 class="mb-1 text-font" style="color: #fff;">Developed by Royex Technologies</h5>
            </div>
        </div>
    </div>

    <script>
        //when clicked on Copy button
        function copyClipBoard(element) {
            var $temp = $("<input>");
            $("body").append($temp);
            $temp.val($(element).text()).select();
            document.execCommand("copy");
            $temp.remove();
        }

        //when clicked on Start now button
        function roomLink() {
            var link = $('#room-created').text();
            $('#start-meeting').attr('href', link);
        }

        var url = $('url').val()
        var ID = $('meeting-ID').val()

        function joinWay(elem) {
            var join_way = $('#join-way').val()
            if (join_way == 'url') {
                $('#url').removeClass('uk-hidden')
                $('#meeting-ID').addClass('uk-hidden')
                $('#button-break').addClass('uk-hidden')
            } else if (join_way == 'meeting-ID') {
                $('#meeting-ID').removeClass('uk-hidden')
                $('#url').addClass('uk-hidden')
                $('#button-break').addClass('uk-hidden')
            }
        }

        $(document).ready(function () {
            $('#join-room').click(e => {
                let url = document.getElementById('room-join-url').value;
                let ID = document.getElementById('room-join-id').value;
                if (url) {
                    window.location = url;
                } else if (!url) {
                    document.getElementById('alert-room-link').classList.remove('uk-hidden')
                    document.querySelector('#err-msg-room-link').innerHTML =
                        "Meeting Link is required !";
                }
                if (ID) {
                    console.log(ID);
                    window.location = `/?room=${ID}`;
                } else if (!ID) {
                    document.getElementById('alert-room-id').classList.remove('uk-hidden')
                    document.querySelector('#err-msg-room-id').innerHTML = "Meeting ID is required !";
                } else if (!ID && !url) {
                    document.getElementById('alert-join-way').classList.remove('uk-hidden')
                    document.querySelector('#err-msg-join-way').innerHTML =
                        "Join way method is required !";
                }
            });

            $('#enter-room').click(e => {
                if (!$('#username').val()) {
                    $('#alert-username').removeClass('uk-hidden')
                }
            });
            console.log();
        });
    </script>
</body>

</html>